<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مصباح متعدد الألوان - متزامن</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 420px;
            margin: 0;
            background-color: #24164e;
            overflow: hidden;
        }
        
        .lamp-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .lamp {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background-color: #ddd;
            margin-bottom: 100px;
            border: 2px solid #999;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .lamp.red {
            background-color: #ff0000;
            box-shadow: 0 0 20px 10px rgba(255, 0, 0, 0.5);
            animation: pulse 0.5s ease-in-out;
        }
        
        .lamp.green {
            background-color: #00ff00;
            box-shadow: 0 0 20px 10px rgba(0, 255, 0, 0.5);
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .reset-btn {
            background-color: rgba(68, 68, 68, 0.7);
            padding: 8px 16px;
            font-size: 14px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            position: absolute;
            opacity: 0;
            visibility: hidden;
            transform: scale(0.8);
        }
        
        .lamp:hover .reset-btn {
            opacity: 1;
            visibility: visible;
            transform: scale(1);
        }
        
        .reset-btn:hover {
            background-color: rgba(68, 68, 68, 0.9);
        }
        
        .reset-btn:active {
            transform: scale(0.95);
        }
        
        .reset-btn:disabled {
            opacity: 0;
            cursor: default;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        
        .color-buttons {
            display: flex;
            gap: 20px;
        }
        
        /* التعديلات الجديدة للأزرار داخل دوائر */
        .button-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .button-circle:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }
        
        .button-circle button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            padding: 0;
            font-size: 16px;
            border: none;
            cursor: pointer;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .button-circle button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .red-btn {
            background-color: #ff4444;
        }
        
        .green-btn {
            background-color: #44ff44;
        }
        
        .status {
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }
        
        .sound-wave {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
        }
        
        .lamp.red .sound-wave {
            background: radial-gradient(circle, rgba(255,0,0,0.4) 0%, rgba(255,0,0,0) 70%);
            animation: soundWave 1s ease-out;
        }
        
        .lamp.green .sound-wave {
            background: radial-gradient(circle, rgba(0,255,0,0.4) 0%, rgba(0,255,0,0) 70%);
            animation: soundWave 1s ease-out;
        }
        
        @keyframes soundWave {
            0% { transform: scale(0.5); opacity: 0.8; }
            100% { transform: scale(1.5); opacity: 0; }
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
    <!-- عنصر صوت مخفي مع صوت جرس أفضل -->
    <audio id="bellSound" preload="auto">
        <source src="https://www.myinstants.com/media/sounds/check-mark_oPG7Xo5.mp3" type="audio/mpeg">
    </audio>
    
    <div class="lamp-container">
        <div class="lamp" id="lamp">
            <div class="sound-wave"></div>
            <button class="reset-btn" id="resetBtn">إعادة التعيين</button>
        </div>
    </div>
    
    <div class="controls">
        <div class="color-buttons">
            <!-- دائرة الزر الأحمر -->
            <div class="button-circle">
                <button class="red-btn" id="redBtn" disabled>أحمر</button>
            </div>
            
            <!-- دائرة الزر الأخضر -->
            <div class="button-circle">
                <button class="green-btn" id="greenBtn" disabled>أخضر</button>
            </div>
        </div>
    </div>
    
    <div class="status" id="status">جاري الاتصال...</div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD5quDLHdvY4FkQ4P2NxFvtlpqZNUBtRTk",
            authDomain: "horror-f741a.firebaseapp.com",
            databaseURL: "https://horror-f741a-default-rtdb.firebaseio.com",
            projectId: "horror-f741a",
            storageBucket: "horror-f741a.appspot.com",
            messagingSenderId: "497946909060",
            appId: "1:497946909060:web:420e6249b36a9bfe1565d1",
            measurementId: "G-7N8ETTVBLK"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // DOM elements
        const lamp = document.getElementById('lamp');
        const redBtn = document.getElementById('redBtn');
        const greenBtn = document.getElementById('greenBtn');
        const resetBtn = document.getElementById('resetBtn');
        const statusEl = document.getElementById('status');
        const bellSound = document.getElementById('bellSound');
        const soundWave = document.querySelector('.sound-wave');
        
        // Sound control
        let soundInitialized = false;
        let isSoundPlaying = false;
        
        // Function to initialize sound (required by some browsers)
        function initializeSound() {
            if (!soundInitialized) {
                // Play and immediately pause to initialize audio context
                bellSound.volume = 0.5;
                bellSound.play().then(() => {
                    bellSound.pause();
                    bellSound.currentTime = 0;
                    soundInitialized = true;
                }).catch(e => {
                    console.log('تهيئة الصوت فشلت:', e);
                });
            }
        }
        
        // Initialize sound on any user interaction
        document.addEventListener('click', initializeSound, { once: true });
        document.addEventListener('keydown', initializeSound, { once: true });
        
        // Play bell sound function
        function playBellSound() {
            if (soundInitialized && !isSoundPlaying) {
                isSoundPlaying = true;
                bellSound.currentTime = 0;
                bellSound.play()
                    .then(() => {
                        // Show sound wave effect
                        soundWave.style.display = 'block';
                        setTimeout(() => {
                            soundWave.style.display = 'none';
                        }, 1000);
                    })
                    .catch(e => console.log('لم يتم تشغيل الصوت:', e))
                    .finally(() => {
                        isSoundPlaying = false;
                    });
            }
        }
        
        // Stop bell sound function
        function stopBellSound() {
            if (isSoundPlaying) {
                bellSound.pause();
                bellSound.currentTime = 0;
                isSoundPlaying = false;
            }
        }
        
        // Connection status
        const connectedRef = database.ref(".info/connected");
        connectedRef.on("value", (snap) => {
            if (snap.val() === true) {
                statusEl.textContent = "متصل - التغييرات ستظهر لجميع المستخدمين";
                statusEl.style.color = "green";
            } else {
                statusEl.textContent = "غير متصل - التغييرات محلية فقط";
                statusEl.style.color = "red";
            }
        });
        
        // Listen for lamp changes
        let previousColor = null;
        database.ref('lamp/color').on('value', (snapshot) => {
            const color = snapshot.val();
            
            if (color) {
                lamp.className = 'lamp ' + color;
                // تعطيل أزرار الألوان عند تفعيل لون
                redBtn.disabled = true;
                greenBtn.disabled = true;
                // تمكين زر إعادة التعيين
                resetBtn.disabled = false;
                
                // تشغيل صوت الجرس عند تغيير اللون (وليس عند التحميل الأولي)
                if (color !== previousColor) {
                    playBellSound();
                }
            } else {
                lamp.className = 'lamp';
                // تمكين أزرار الألوان عند إعادة التعيين
                redBtn.disabled = false;
                greenBtn.disabled = false;
                // تعطيل زر إعادة التعيين
                resetBtn.disabled = true;
                
                // إيقاف الصوت عند إعادة التعيين
                stopBellSound();
            }
            
            previousColor = color;
        });
        
        // Button handlers
        redBtn.addEventListener('click', () => {
            initializeSound();
            database.ref('lamp').set({ color: 'red' });
        });
        
        greenBtn.addEventListener('click', () => {
            initializeSound();
            database.ref('lamp').set({ color: 'green' });
        });
        
        resetBtn.addEventListener('click', () => {
            initializeSound();
            database.ref('lamp').set({ color: null });
        });
        
        // تعطيل زر إعادة التعيين في البداية إذا لم يكن هناك لون
        database.ref('lamp/color').once('value').then((snapshot) => {
            if (!snapshot.val()) {
                resetBtn.disabled = true;
            }
        });
    </script>
</body>
</html>